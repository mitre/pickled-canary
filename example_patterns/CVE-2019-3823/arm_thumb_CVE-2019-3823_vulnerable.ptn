; This pattern tests for the presence of CVE-2019-3144 for ARM:LE:32:v8 thumb.

; Info about the CVE: https://github.com/curl/curl/commit/39df4073e5413fcdbb5a38da0c1ce6f1c0ceb484
; Summary: This CVE involves a buffer overflow vulnerability while using the strtol function. A
; string is passed into the strtol function, but if no null terminator is present within the
; string's buffer, strtol will overread the buffer.

; Vulnerable code:
; if(line[3] == ' ' || len == 5) {
;    *resp = curlx_sltosi(strtol(line, NULL, 10)); //line variable may not have null terminator
; }

; Pattern written with: libcurl/libcurl_versions/from_tool/testdata/libcurl.so.4.3.0_V5.21(AATB.3)C0.zip.cc7fafcf1330ad57be6c4f5ce3437f1fa25cac35c26fbf92f7c0ae6344865511
;        000337ac 20  2b           cmp        r3,#0x20
;        000337ae 01  d0           beq        LAB_000337b4
;        000337b0 05  2e           cmp        r6,#0x5
;        000337b2 0d  d1           bne        LAB_000337d0
;                             LAB_000337b4
;        000337b4 00  21           movs       r1,#0x0
;        000337b6 0a  22           movs       r2,#0xa
;        000337b8 20  46           mov        r0,r4
;        000337ba e1  f7  72  e9    blx        <EXTERNAL>::strtol
;        000337be 02  f0  5f  f8    bl         FUN_00035880

; check line[3] ==  ' '
cmp `Q1/r.`,#0x20

`ANY_BYTES{0,2}`

; check len == 5
cmp `Q2/r.`,#0x5

`ANY_BYTES{0,14}`

; pass - as 2nd arg and 10 as the 3rd arg into strtol
movs r1,#0x0
movs r2,#0xa

`ANY_BYTES{0,2}`

; call strtol
blx `*`

; call curlx_sltosi
bl `*`

; Copyright (C) 2025 The MITRE Corporation All Rights Reserved
