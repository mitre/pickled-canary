; This pattern tests for the presence of CVE-2019-3823 for MIPS:LE:32:default.

; Info about the CVE: https://github.com/curl/curl/commit/39df4073e5413fcdbb5a38da0c1ce6f1c0ceb484
; Summary: This CVE involves a buffer overflow vulnerability while using the strtol function. A
; string is passed into the strtol function, but if no null terminator is present within the
; string's buffer, strtol will overread the buffer.

; Vulnerable code:
; if(line[3] == ' ' || len == 5) {
;    *resp = curlx_sltosi(strtol(line, NULL, 10)); //line variable may not have null terminator
; }

; Pattern written with: libcurl/libcurl_versions/from_tool/testdata/libcurl.so.4.3.0_1.2.0.62.zip.03b34fc901db3fc2364f82cc529a20284fb1b3c1520ef276423d04aaaaa6ea8b_1
;        00046648 03  00  a3  80    lb         v1,0x3 (a1)
;        0004664c 20  00  02  24    li         v0,0x20
;        00046650 03  00  62  10    beq        v1,v0,LAB_00046660
;        00046654 05  00  02  24    _li        v0,0x5
;        00046658 10  00  c2  54    bnel       a2,v0,LAB_0004669c
;        0004665c 2d  00  05  24    _li        a1,0x2d
;                             LAB_00046660
;        00046660 a4  86  99  8f    lw         t9,-0x795c (gp)=>-><EXTERNAL>::strtol
;        00046664 21  20  a0  00    move       a0,a1
;        00046668 0a  00  06  24    li         a2,0xa
;        0004666c 09  f8  20  03    jalr       t9=><EXTERNAL>::strtol
;        00046670 21  28  00  00    _clear     a1
;        00046674 10  00  bc  8f    lw         gp,local_10 (sp)
;        00046678 5c  81  99  8f    lw         t9,-0x7ea4 (gp)=>->FUN_0004914c
;        0004667c 09  f8  20  03    jalr       t9=>FUN_0004914c


; check line[3] == ' '
lb `Q1/v.`,0x3(`Q2/a.`)
li `Q3/v.`,0x20
beq `Q1`,`Q3`,`*`

; check len == 5
li `Q4/v.`,0x5
bnel `Q5/a.`,`Q4`,`*`

`ANY_BYTES{0,16}`

; call strtol
jalr `*`

`ANY_BYTES{0,12}`

; call curlx_sltosi
jalr `*`


; Copyright (C) 2023 The MITRE Corporation All Rights Reserved
