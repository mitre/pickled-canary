; MIPS CVE-2019-3822

; This tests for code prior to the fix at:
; https://github.com/curl/curl/commit/50c9484278c63b958655a717844f0721263939cc

; the condition "if (size < (0x400 - ntresplen))" is vulnerable to an integer overflow
; specifically if ntresplen is greater than 0x400

; libcurl.so.4.3.0_5.50(ABEL.2)C0.zip.fae4f4bf510a453a978c31aadde1e961b54d2834d509f3c77aa1493fcf7b3c4b
; 0x00040a90

; lw Q1, 0xfc(*)
; li Q2, 0x400
; subu Q2, Q2, Q1
; sltu Q2, *, Q2
; bne Q2, zero, *

; load value into ntresplen (Q1)
lw `Q1`,0xfc(`*`)

; load 0x400 into Q2
li `Q2`,0x400

; subtract ntresplen from 0x400 and place difference in Q2
subu `Q2`,`Q2`,`Q1`

; check if size < Q2
sltu `Q2`,`*`,`Q2`
bne `Q2`,zero,`*`

; Copyright (C) 2023 The MITRE Corporation All Rights Reserved
