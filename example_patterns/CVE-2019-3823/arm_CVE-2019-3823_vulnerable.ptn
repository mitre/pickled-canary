; This pattern tests for the presence of CVE-2019-3144 for ARM:LE:32:v8.

; Info about the CVE: https://github.com/curl/curl/commit/39df4073e5413fcdbb5a38da0c1ce6f1c0ceb484
; Summary: This CVE involves a buffer overflow vulnerability while using the strtol function. A
; string is passed into the strtol function, but if no null terminator is present within the
; string's buffer, strtol will overread the buffer.

; Vulnerable code:
; if(line[3] == ' ' || len == 5) {
;    *resp = curlx_sltosi(strtol(line, NULL, 10)); //line variable may not have null terminator
; }

; Pattern written with:
; 1) libcurl/libcurl_versions/from_tool/testdata/libcurl.so.5.3.0_2.1.2__b.img.b73debbf9bcb1ab55e4dd75acd99d000727be6c95d72609873429a591dd70120
;        0004291c 05  00  57  e3    cmp        r7,#0x5
;        00042920 20  00  53  13    cmpne      r3,#0x20
;        00042924 00  00  a0  13    movne      r0,#0x0
;        00042928 01  00  a0  03    moveq      r0,#0x1
;        0004292c 0a  00  00  1a    bne        LAB_0004295c
;        00042930 00  10  a0  e3    mov        r1,#0x0
;        00042934 0a  20  a0  e3    mov        r2,#0xa
;        00042938 05  00  a0  e1    cpy        r0,r5
;        0004293c 77  4a  ff  eb    bl         <EXTERNAL>::strtol
;        00042940 fd  09  00  eb    bl         FUN_0004513c

; and 2) libcurl/libcurl_versions/from_tool/testdata/libcurl.so.5.3.0_2.1.11.197735.img.63600c6c1e5c8fed935fb61e7b3b3049cc49a2214514cd8bf3e8769e76de9b44
;        00042564 20  00  53  e3    cmp        r3,#0x20
;        00042568 01  00  00  0a    beq        LAB_00042574
;        0004256c 05  00  52  e3    cmp        r2,#0x5
;        00042570 0a  00  00  1a    bne        LAB_000425a0
;                             LAB_00042574
;        00042574 0a  20  a0  e3    mov        r2,#0xa
;        00042578 01  00  a0  e1    cpy        r0,r1
;        0004257c 00  10  a0  e3    mov        r1,#0x0
;        00042580 05  4e  ff  eb    bl         <EXTERNAL>::strtol
;        00042584 7d  09  00  eb    bl         FUN_00044b80

; check line[3] == ' ' and len == 5
`START_OR`
    cmp `Q1/r.`,#0x5
    `ANY_BYTES{0,4}`
    cmpne `Q2/r.`,#0x20
`OR`
    cmp `Q2`,#0x20
    `ANY_BYTES{0,4}`
    cmp `Q1`,#0x5
`END_OR`

`ANY_BYTES{0,44}`

; pass - as 2nd arg and 10 as the 3rd arg into strtol
`START_OR`
    mov r1,#0x0
    `ANY_BYTES{0,4}`
    mov r2,#0xa
`OR`
    mov r2,#0xa
    `ANY_BYTES{0,4}`
    mov r1,#0x0
`END_OR`

`ANY_BYTES{0,4}`

; call strtol
bl `*`

; call curlx_sltosi
bl `*`

; Copyright (C) 2025 The MITRE Corporation All Rights Reserved
