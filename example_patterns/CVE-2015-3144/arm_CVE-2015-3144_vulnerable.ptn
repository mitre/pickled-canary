; This pattern tests for the presence of CVE-2015-3144 for ARM:LE:32:v8.

; Info about the CVE: https://github.com/curl/curl/commit/0583e87ada7a3cfb10904ae4ab61b339582c5bd3
; Summary: A hostname is passed into a function, and the last character (len - 1) character is
; read. It is also set to a null character if certain conditions are met. A hostname that has a
; length of zero will cause the program to read and write to memory not part of the hostname.

; Vulnerable code:
; len = strlen(host->name);
; if(host->name[len-1] == '.') //does not check if len-1 is negative
;   host->name[len-1]=0;

; Pattern written with: libcurl/libcurl_versions/cameras/libcurl.so.4.3.0_yi_home_1.8.7.0D_201708091510
;        0001e768 6c  ce  ff  eb    bl         <EXTERNAL>::strlen
;        0001e76c 4c  60  9f  e5    ldr        r6,[DAT_0001e7c0 ]
;        0001e770 06  60  8f  e0    add        r6,pc,r6
;        0001e774 01  00  40  e2    sub        r0,r0,#0x1
;        0001e778 00  30  d4  e7    ldrb       r3,[r4,r0]
;        0001e77c 2e  00  53  e3    cmp        r3,#0x2e

; call to strlen
bl `*`

`ANY_BYTES{0,8}`

; calculate (len-1)
sub `Q1/r..?`,`Q1`,#0x1

; get last character of hostname -- host->name[len-1]
ldrb `Q2/r..?`,[`Q3/r..?`,`Q1`]

; check if last character of hostname is '.' character
cmp `Q2`,#0x2e

`ANY_BYTES{24,40}`

tst `Q4/r..?`,#0x80

; Copyright (C) 2023 The MITRE Corporation All Rights Reserved
